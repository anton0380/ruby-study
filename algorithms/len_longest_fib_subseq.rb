require 'benchmark'

# @param {Integer[]} arr
# @return {Integer}
def len_longest_fib_subseq(arr)
  max_seq = 0
  cur_seq = 0
  max_value = arr.max
  h = {}
  arr.each do |v|
    h[v] = 1
  end
  (0..arr.length-3).each do |v1|
    (v1+1..arr.length-2).each do |v2|
      cur_seq = 0
      val_prew = arr[v1]
      val_now = arr[v2]
      loop do
        val_now, val_prew = val_now + val_prew, val_now
        break if val_now > max_value

        if h.key? val_now
          cur_seq = 2 if cur_seq.zero?
          cur_seq += 1
        else
          break
        end
      end
      max_seq = [max_seq, cur_seq].max
    end
  end
  max_seq
end

arr = [1,2,3,4,5,6,7,8]
puts len_longest_fib_subseq arr
# Output: 5
# Explanation: The longest subsequence that is fibonacci-like: [1,2,3,5,8].


arr = [1,3,7,11,12,14,18]
puts len_longest_fib_subseq arr
# Output: 3
# Explanation: The longest subsequence that is fibonacci-like: [1,11,12], [3,11,14] or [7,11,18].

arr = [1,3,5]
puts len_longest_fib_subseq arr
# Output: 0

arr = [25,56,70,75,95,100,130,140,173,179,196,197,216,218,236,248,256,281,309,310,336,353,357,389,395,402,406,416,420,454,480,488,491,514,519,526,532,548,575,585,586,591,593,594,597,603,612,613,617,622,641,681,689,690,695,697,727,730,774,791,797,807,815,824,842,859,868,889,892,901,907,908,926,934,946,963,970,985,996,999,1009,1055,1100,1133,1144,1196,1235,1244,1261,1267,1285,1294,1323,1349,1398,1400,1416,1441,1452,1467,1492,1518,1530,1563,1583,1590,1612,1633,1712,1718,1834,1909,1948,1974,1991,2003,2040,2050,2076,2082,2143,2169,2207,2257,2265,2268,2305,2359,2378,2393,2419,2431,2475,2492,2517,2553,2586,2621,2812,2851,2872,2978,3095,3199,3215,3218,3285,3367,3425,3430,3559,3580,3607,3668,3703,3706,3826,3830,3885,3949,3994,4035,4108,4125,4136,4176,4233,4524,4569,4781,4812,5135,5163,5192,5202,5276,5335,5449,5501,5599,5702,5814,5837,5936,5971,6008,6185,6208,6278,6368,6425,6552,6583,6617,6689,6762,6854,7336,7420,7653,7790,8230,8378,8401,8410,8561,8620,8816,8926,9029,9261,9417,9421,9604,9677,9711,10011,10038,10163,10317,10419,10587,10691,10742,10825,10938,11087,11860,11989,12434,12602,13365,13541,13602,13603,13837,13955,14265,14427,14628,14963,15235,15254,15540,15648,15719,16196,16246,16441,16685,16844,17139,17274,17359,17514,17700,17941,19196,19409,20087,20392,21595,21919,22004,22012,22398,22575,23081,23353,23657,24224,24656,24671,25144,25325,25430,26207,26284,26604,27002,27263,27726,27965,28101,28339,28638,29028,31056,31398,32521,32994,34960,35460,35607,35614,36235,36530,37346,37780,38285,39187,39891,39925,40684,40973,41149,42403,42530,43045,43687,44107,44865,45239,45460,45853,46338,46969,50252,50807,52608,53386,56555,57379,57611,57626,58633,59105,60427,61133,61942,63411,64547,64596,65828,66298,66579,68610,68814,69649,70689,71370,72591,73204,73561,74192,74976,75997,81308,82205,85129,86380,91515,92839,93218,93240,94868,95635,97773,98913,100227,102598,104438,104521,106512,107271,107728,111013,111344,112694,114376,115477,117456,118443,119021,120045,121314,122966,131560,133012,137737,139766,148070,150218,150829,150866,153501,154740,158200,160046,162169,166009,168985,169117,172340,173569,174307,179623,180158,182343,185065,186847,190047,191647,192582,194237,196290,198963,212868,215217,222866,226146,239585,243057,244047,244106,248369,250375,255973,258959,262396,268607,273423,273638,278852,280840,282035,290636,291502,295037,299441,302324,307503,310090,311603,314282,317604,321929,344428,348229,360603,365912,387655,393275,394876,394972,401870,405115,414173,419005,424565,434616,442408,442755,451192,454409,456342,470259,471660,477380,484506,489171,497550,501737,504185,508519,513894,520892,557296,563446,583469,592058,627240,636332,638923,639078,650239,655490,670146,677964,686961,703223,715831,716393,730044,735249,738377,760895,763162,772417,783947,791495,805053,811827,815788,822801,831498,842821,901724,911675,944072,957970,1014895,1029607,1033799,1034050,1052109,1060605,1084319,1096969,1111526,1137839,1158239,1159148,1181236,1189658,1194719,1231154,1234822,1249797,1268453,1280666,1302603,1313564,1319973,1331320,1345392,1363713,1459020,1475121,1527541,1550028,1642135,1665939,1672722,1673128,1702348,1716095,1754465,1774933,1798487,1841062,1874070,1875541,1911280,1924907,1933096,1992049,1997984,2022214,2052400,2072161,2107656,2125391,2135761,2154121,2176890,2206534,2360744,2386796,2471613,2507998,2657030,2695546,2706521,2707178,2754457,2776700,2838784,2871902,2910013,2978901,3032309,3034689,3092516,3114565,3127815,3223203,3232806,3272011,3320853,3352827,3410259,3438955,3455734,3485441,3522282,3570247,3819764,3861917,3999154,4058026,4299165,4361485,4379243,4380306,4456805,4492795,4593249,4646835,4708500,4819963,4906379,4910230,5003796,5039472,5060911,5215252,5230790,5294225,5373253,5424988,5517915,5564346,5591495,5639562,5699172,5776781,6180508,6248713,6470767,6566024,6956195,7057031,7085764,7087484,7211262,7269495,7432033,7518737,7618513,7798864,7938688,7944919,8096312,8154037,8188726,8438455,8463596,8566236,8694106,8777815,8928174,9003301,9047229,9125003,9221454,9347028,10000272,10110630,10469921,10624050,11255360,11418516,11465007,11467790,11668067,11762290,12025282,12165572,12327013,12618827,12845067,12855149,13100108,13193509,13249637,13653707,13694386,13860461,14067359,14202803,14446089,14567647,14638724,14764565,14920626,15123809,16180780,16359343,16940688,17190074,18211555,18475547,18550771,18555274,18879329,19031785,19457315,19684309,19945526,20417691,20783755,20800068,21196420,21347546,21438363,22092162,22157982,22426697,22761465,22980618,23374263,23570948,23685953,23889568,24142080,24470837,26181052,26469973,27410609,27814124,29466915,29894063,30015778,30023064,30547396,30794075,31482597,31849881,32272539,33036518,33628822,33655217,34296528,34541055,34688000,35745869,35852368,36287158,36828824,37183421,37820352,38138595,38324677,38654133,39062706,39594646,42361832,42829316,44351297,45004198,47678470,48369610,48566549,48578338,49426725,49825860,50939912,51534190,52218065,53454209,54412577,54455285,55492948,55888601,56126363,57838031,58010350,58713855,59590289,60164039,61194615,61709543,62010630,62543701,63204786,64065483,68542884,69299289,71761906,72818322,77145385,78263673,78582327,78601402,79974121,80619935,82422509,83384071,84490604,86490727,88041399,88110502,89789476,90429656,90814363,93583900,93862718,95001013,96419113,97347460,99014967,99848138,100335307,101197834,102267492,103660129,110904716,112128605,116113203,117822520,124823855,126633283,127148876,127179740,129400846,130445795,133362421,134918261,136708669,139944936,142453976,142565787,145282424,146318257,146940726,151421931,151873068,153714868,156009402,157511499,160209582,161557681,162345937,163741535,165472278,167725612,179447600,181427894,187875109,190640842,201969240,204896956,205731203,205781142,209374967,211065730,215784930,218302332,221199273,226435663,230495375,230676289,235071900,236747913,237755089,245005831,245735786,248715881,252428515,254858959,259224549,261405819,262681244,264939369,267739770,271385741,290352316,293556499,303988312,308463362,326793095,331530239,332880079,332960882,338775813,341511525,349147351,353220593,357907942,366380599,372949351,373242076,380354324,383066170,384695815,396427762,397608854,402430749,408437917,412370458,419434131,422963500,425027181,428680904,433212048,439111353,469799916,474984393,491863421,499104204,528762335,536427195,538611282,538742024,548150780,552577255,564932281,571522925,579107215,592816262,603444726,603918365,615426224,619814083,622450904,641433593,643344640,651146630,660866432,667229417,678658680,684369319,687708425,693620273,700951818,710497094,760152232,768540892,795851733,807567566,855555430,867957434,871491361,871702906,886926593,894088780,914079632,924743518,937015157,959196861,976394077,977160441,995780548]

bench = Benchmark.measure {
  puts len_longest_fib_subseq arr
}
puts bench.real # here 0.1353741610000725
