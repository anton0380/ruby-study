require 'benchmark'

# @param {Integer[]} rating
# @return {Integer}
def num_teams(rating)
  result = 0
  rating[..-3].each_with_index do |r1, i|
    rating[i+1..-2].each_with_index do |r2, j|
      if r1 > r2
        rating[j+i+1..].each do |r3|
          result += 1 if r2 > r3
        end  
      end
      if r1 < r2
        rating[j+i+1..].each do |r3|
          result += 1 if r2 < r3
        end  
      end
    end
  end
  result
end

rating =
[111,1537,162,71,1082,1524,2698,2164,1347,20,409,2313,2350,638,2424,2468,107,125,1184,594,1375,2096,1986,2300,1785,2217,2943,2860,200,1469,1786,2075,2120,598,216,366,2836,106,1467,767,2305,550,2166,1804,737,223,1310,231,92,1067,1017,1364,1629,1642,792,1730,902,1768,2074,848,1325,1798,2138,1683,1759,9,2874,354,530,2389,2671,1717,2457,1751,1397,356,2357,2189,1358,1619,1095,1026,1134,2370,1542,1495,1231,953,1918,1885,2998,73,2198,602,567,1830,2270,2564,2919,2762,2684,965,344,156,1479,1981,521,466,1916,1078,121,1609,944,1263,1081,660,474,518,1805,679,1120,1128,2053,1932,979,2881,2387,2333,2102,61,221,1640,1499,1988,854,2,1645,2848,2214,1516,2497,2647,2740,915,246,379,2954,1512,1484,277,1824,656,1265,58,3000,1362,2824,1461,1520,390,2525,2759,2267,2614,355,362,1481,1572,1863,360,2725,1920,2371,2810,1888,1079,1847,2996,1955,215,1801,674,1020,2368,1167,1668,1616,6,417,2471,217,2196,901,2456,2183,1329,458,2589,2906,381,279,1094,1156,1400,2221,1607,1569,170,1789,2679,222,1247,1740,1536,197,943,1151,343,2098,929,713,103,1592,373,829,938,319,1737,1702,763,2050,2070,2826,2498,1442,1980,2306,50,2239,1755,149,152,728,837,429,1378,2168,2971,2606,563,1903,411,213,1821,1652,2979,1722,1032,1377,1443,1819,1521,2538,733,116,2191,2489,1352,890,2575,795,710,2218,228,2522,377,1896,1925,427,2014,1359,820,2205,1531,309,985,606,1849,1293,1213,1943,274,2727,81,1838,898,2807,817,185,519,531,85,2383,583,1277,561,1912,1152,1260,2449,368,755,645,1494,897,2648,1539,1595,1690,2884,2047,1907,783,2144,1008,2118,1117,2257,1110,95,2177,1266,2255,557,2114,115,2088,726,1882,942,224,332,2649,1196,1290,1800,2455,2353,1671,604,33,2040,340,2992,2240,1795,393,2315,1003,2065,802,2060,2552,1341,134,568,1226,268,2097,860,2591,708,313,2610,2728,2924,285,467,757,271,2099,1244,899,2713,2141,478,1073,122,2496,1877,652,2779,2630,431,894,1772,2981,336,1538,79,59,2889,2784,1236,350,2404,1581,2743,164,865,1917,1053,1471,2445,2697,961,1732,773,1504,2862,2362,945,1044,1990,1360,295,1232,815,2988,327,136,1604,1999,1992,873,2527,2783,186,1470,921,1018,1672,2509,1191,2302,2297,15,1551,2521,1941,1363,2748,732,1501,1319,838,626,66,1282,920,1161,1433,404,2846,218,1610,688,556,2989,1357,2790,971,2723,2347,2768,1013,2746,967,1407,534,1735,2816,1289,359,2429,1111,1268,752,1556,2837,337,1466,448,2670,2934,1085,2021,1761,1685,2180,1250,2277,871,2438,178,1661,318,195,2702,421,2771,325,1842,863,695,1860,659,2010,1976,2268,181,819,91,2364,375,904,1658,130,2216,2078,1792,2945,2997,1339,1669,1242,1541,1491,2154,2363,2072,1027,2953,1413,1677,951,2668,31]
bench = Benchmark.measure {
  puts num_teams rating # 9142022
}
puts bench.real # old 1.289849550999861 new 

rating =
[1414,158,710,2814,965,585,620,52,2327,2390,2018,486,1166,2997,2715,336,2143,283,2705,467,381,2463,3000,703,1096,265,130,100,2194,2484,2501,1673,65,2447,663,2136,2039,2683,2093,2504,495,805,2712,512,85,1353,1520,2189,1274,1038,1829,2235,2127,2422,1569,731,469,2602,946,345,2292,2805,1579,1384,2040,921,1677,1074,814,1243,1537,2993,2596,1557,2034,2719,1185,80,1872,842,1546,1430,1212,2284,12,629,617,1661,1442,2356,1067,2632,753,1774,1848,916,728,1818,841,2804,779,280,2436,1519,1440,2291,760,2205,276,2057,563,822,707,2112,2701,113,263,164,2027,478,1705,1494,2208,1897,2352,2773,866,2725,645,1088,1361,48,2643,369,2038,2398,801,373,485,2916,2963,2467,2713,54,2396,1270,1322,2151,1046,1469,2965,1313,2191,1623,340,1299,714,851,797,2584,1016,649,2800,2911,894,930,2366,1948,2351,2223,1835,67,2512,51,1992,1903,1041,604,2401,943,2991,2367,1699,2097,671,1535,1856,1688,194,2454,2689,2718,2013,1665,2437,1823,242,719,1861,2329,2486,150,1454,2594,2192,2044,742,1629,1931,1127,64,2244,389,1698,2354,1639,2954,2700,1967,97,2174,2679,812,2024,2574,1175,1246,1236,647,1759,844,2005,35,195,1493,43,197,2310,2830,2193,2369,1044,406,1898,2211,1630,745,1297,665,2710,2442,2889,1521,2263,2011,2798,1189,2985,231,1102,2145,941,162,2478,1982,1601,1421,1918,2631,944,1220,1859,2690,219,1398,1604,1183,2121,2086,1068,1251,2111,2020,143,2844,198,1717,2957,2595,2381,1985,2851,2061,1385,1156,696,545,1203,901,1502,254,2187,1367,28,2818,1037,517,2677,134,2854,2423,1,298,2389,2008,2842,1868,302,2152,1562,754,2903,1561,1470,1943,1076,987,1578,2949,1081,2458,608,1882,1485,896,1410,2582,669,256,1913,2046,1965,272,170,1807,2471,1885,1153,1907,331,1524,989,2344,243,1177,2202,1712,1953,1054,1625,1827,2550,112,1459,1226,751,556,1933,1810,2681,2990,1465,631,2958,2824,1248,2864,1254,222,1732,501,2470,2156,687,2765,1260,2311,133,2651,1452,2334,878,2479,1125,746,23,258,1637,2142,1308,2502,1210,686,141,1990,2457,1301,2987,834,2675,1196,2264,1761,2625,2953,1422,729,1293,1172,2489,1233,1239,2724,127,2544,632,1805,2146,422,1143,2951,2564,252,2912,2350,981,1007,1373,1619,2132,172,268,1105,2138,2802,1173,300,1002,664,1320,997,1517,1352,882,2739,2728,2338,1436,446,1492,506,2559,1201,885,1111,1813,514,2424,2070,1039,59,2047,1199,2275,838,1026,1427,2259,2845,717,701,2197,1224,2462,2518,781,1668,2960,1141,1434,1008,2726,1850,1873,1779,2736,764,2238,399,2714,1735,2716,317,1832,1245,228,1474,2838,641,1020,934,2359,239,318,361,2167,1342,2721,798,2532,312,794,2393,782,1473,2915,2979,2343,802,1996,1478,1471,1816,2861,609,1193,1680,2934,2707,2590,858,1666,2099,2410,2857,156,2273,108,672,771,1504,2196,1244,677,2812,1523,534,1169,2461,658,1392,2052,1029,2466,2368,1278,2576,2200,2629,2468,1917,2823,2939,2134,642,2117,1476,1881,2460,484,261,275,1508,2503,2150,1643,2472,2165,1325,1501,1785,790,1375,1180,383,2959,2270,223,1290,148,324,1294,536,2362,2699,1603,2131,567,2635,1505]
bench = Benchmark.measure {
  puts num_teams rating # 12670965
}
puts bench.real # old 1.8092223849998845 new 

# rating = [2,5,3,4,1] # 3
# puts num_teams rating
# rating = [2,1,3] # 0
# puts num_teams rating
# rating = [1,2,3,4] # 4
# puts num_teams rating
